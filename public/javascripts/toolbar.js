// Generated by CoffeeScript 1.4.0
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  define(['jquery', 'underscore', 'EventEmitter', 'commands'], function($, _, event_emitter, commands) {
    var ToolBar;
    return ToolBar = (function() {

      function ToolBar(items_class_selector, default_command) {
        this.applyCommand = __bind(this.applyCommand, this);

        var _this = this;
        this.current_command = commands[default_command];
        this.toolbar_items = $(items_class_selector);
        event_emitter.on("ItemSelected", this.applyCommand);
        event_emitter.on("ItemDeSelected", function() {
          var _ref;
          console.log("toolbar ItemDelected:");
          if ((_ref = _this.current_command) != null) {
            _ref.unbind(_this.selected_canvas_item);
          }
        });
        this.toolbar_items.click(function(evt, ui) {
          var command_name, menu_item, _ref;
          menu_item = $(evt.currentTarget);
          command_name = menu_item.data('action');
          console.log("selected action: " + command_name);
          if (((_ref = _this.current_command) != null ? _ref.commandName : void 0) === command_name) {
            return;
          }
          if (_this.selected_canvas_item) {
            _this.current_command.unbind(_this.selected_canvas_item);
          }
          _this.current_command = commands[command_name];
          _this.applyCommand(_this.selected_canvas_item);
          _this.set_active(menu_item);
          return event_emitter.emit('Toolbar.MenuItemSelected', command_name);
        });
      }

      ToolBar.prototype.set_active = function(toolbar_item) {
        var i, _i, _len, _ref;
        _ref = this.toolbar_items;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          i = _ref[_i];
          if ($(i).hasClass('active')) {
            $(i).removeClass('active');
          }
        }
        return toolbar_item.addClass('active');
      };

      ToolBar.prototype.set_initial_active = function() {
        var active_item, i, _i, _len, _ref;
        _ref = this.toolbar_items;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          i = _ref[_i];
          if ($(i).hasClass('active')) {
            active_item = $(i);
          }
        }
        if (active_item == null) {
          active_item = this.toolbar_items[0];
        }
        return this.set_active(active_item);
      };

      ToolBar.prototype.applyCommand = function(item) {
        this.selected_canvas_item = item;
        console.log("canvas item selected toolbar handler");
        return this.current_command.bind_to(item);
      };

      return ToolBar;

    })();
  });

}).call(this);

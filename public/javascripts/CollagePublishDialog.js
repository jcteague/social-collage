// Generated by CoffeeScript 1.4.0
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  define(['jquery', 'EventEmitter'], function($, event_emitter) {
    var CollagePublishDialog;
    return CollagePublishDialog = (function() {

      function CollagePublishDialog() {
        this.on_save_collage = __bind(this.on_save_collage, this);

        this.show_saved = __bind(this.show_saved, this);

        this.show_loading = __bind(this.show_loading, this);

        this.show = __bind(this.show, this);
        this.modal = $('#publish-collage-modal');
        this.preview_buttons = $('.modal-footer .preview button');
        $('#save-collage').click(this.on_save_collage);
        this.comment = $('#publish-comments');
        event_emitter.on('PublishButtonClicked', this.show);
        event_emitter.on('loading.photo.publish.completed', this.show_saved);
      }

      CollagePublishDialog.prototype.reset = function() {
        this.modal.find('.preview').show();
        this.preview_buttons.removeAttr('disabled');
        this.modal.find('.saved').hide();
        return this.modal.find('.loading').hide();
      };

      CollagePublishDialog.prototype.show = function(collage_data) {
        this.collage_data = collage_data;
        this.reset();
        $('#collage-preview').css('background-image', "url('" + this.collage_data.url + "')");
        console.log("showing publish modal " + this.collage_data);
        return this.modal.modal('show');
      };

      CollagePublishDialog.prototype.show_loading = function() {
        this.modal.find('.preview').hide();
        return this.modal.find('.loading').show();
      };

      CollagePublishDialog.prototype.show_saved = function() {
        console.log("publish complted");
        this.modal.find('.preview').hide();
        return this.modal.find('.saved').show();
      };

      CollagePublishDialog.prototype.on_save_collage = function(evt) {
        var collage_id, comments, url;
        this.show_loading();
        this.preview_buttons.attr('disabled');
        comments = this.comment.val();
        url = this.collage_data.url;
        collage_id = this.collage_data.id;
        return event_emitter.emit("PhotoPublishClicked", {
          id: collage_id,
          url: url,
          comments: comments
        });
      };

      return CollagePublishDialog;

    })();
  });

}).call(this);

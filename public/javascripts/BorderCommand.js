// Generated by CoffeeScript 1.4.0
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  define(['fabric', 'EventEmitter'], function(fabric, event_emitter) {
    var BorderCommand;
    return BorderCommand = (function() {

      function BorderCommand(menu, on_applied, on_deactivate) {
        this.menu = menu;
        this.on_applied = on_applied;
        this.on_deactivate = on_deactivate;
        this.remove_border = __bind(this.remove_border, this);

        this.set_border = __bind(this.set_border, this);

      }

      BorderCommand.prototype.set_border = function(border) {
        var strokeColor, strokeWidth;
        if ((border.size != null) > 0) {
          strokeWidth = parseInt(border.size);
        } else {
          strokeWidth = false;
        }
        strokeColor = this.format_rgba_string(border.color);
        console.log("setting border: " + strokeWidth + ", " + strokeColor);
        this.canvas_item.item.set("strokeWidth", strokeWidth);
        return this.canvas_item.item.set("stroke", strokeColor);
      };

      BorderCommand.prototype.activate = function(canvas_item) {
        var f_item,
          _this = this;
        this.canvas_item = canvas_item;
        f_item = this.canvas_item.item;
        this.original_border = {
          strokWidth: f_item.get('strokeWidth', f_item.get('stroke'))
        };
        this.menu.setBorderWidth(f_item.get('strokeWidth'));
        this.menu.setBorderColor(f_item.get('stroke'));
        event_emitter.on("submenu.border.widthSet", function(evt) {
          console.log("border stroke");
          console.log(evt);
          return _this.set_border(evt);
        });
        event_emitter.on("submenu.border.colorSet", function(evt) {
          console.log("border color");
          console.log(evt);
          return _this.set_border(evt);
        });
        event_emitter.on('submenu.apply.border', function(border) {
          console.log("apply border");
          console.log(border);
          _this.set_border(border);
          return _this.on_applied();
        });
        return event_emitter.on('submenu.cancel.border', function() {
          return _this.deactivate();
        });
      };

      BorderCommand.prototype.format_rgba_string = function(color) {
        return "rgba(" + color.r + "," + color.g + "," + color.b + "," + color.a + ")";
      };

      BorderCommand.prototype.deactivate = function() {
        this.remove_border();
        return this.on_deactivate();
      };

      BorderCommand.prototype.remove_border = function() {
        this.canvas_item.item.set(this.original_border);
        return this.canvas_item.stage.renderAll();
      };

      return BorderCommand;

    })();
  });

}).call(this);

// Generated by CoffeeScript 1.4.0
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  define(['EventEmitter', 'Collage', 'Toolbar', 'Commands'], function(event_emitter, Collage, Toolbar, commands) {
    var App;
    return App = (function() {

      function App(canvas_element) {
        this.canvas_element = canvas_element;
        this.onToolbarItemSelected = __bind(this.onToolbarItemSelected, this);

        this.onCanvasItemSelected = __bind(this.onCanvasItemSelected, this);

        this.collage = new Collage(this.canvas_element);
        this.toolbar = new Toolbar('#collage-menu-list .menu-item');
        this.selected_command = commands.resize;
        event_emitter.on("ItemSelected", this.onCanvasItemSelected);
        event_emitter.on("Toolbar.MenuItemSelected", this.onToolbarItemSelected);
      }

      App.prototype.setToolbarAction = function(action) {
        this.toolbarAction = action;
        return this.event_emitter.emit("toolbar-action-selected", action);
      };

      App.prototype.onCanvasItemSelected = function(item_type, item) {
        console.log("oncanvas click event " + item_type + " item type");
        return this.selected_command.bind_to(item);
      };

      App.prototype.onToolbarItemSelected = function(command) {
        console.log("Toobar Item command: " + command);
        this.selected_command = commands[command];
        if (this.collage.currentItem != null) {
          return this.selected_command.bind_to(this.collage.currentItem);
        }
      };

      return App;

    })();
  });

}).call(this);
